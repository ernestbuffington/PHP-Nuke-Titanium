jquery_prefix(function(t){t.fn.upload=function(e,a,n,r){return"object"!=typeof a&&(r=n,n=a),this.each(function(){if(t(this)[0].files[0]){var o=new FormData;if(o.append(t(this).attr("name"),t(this)[0].files[0]),"object"==typeof a)for(var p in a)o.append(p,a[p]);t.ajax({url:e,type:"POST",xhr:function(){return myXhr=t.ajaxSettings.xhr(),myXhr.upload&&r&&myXhr.upload.addEventListener("progress",function(e){var a=~~(e.loaded/e.total*100);r&&"function"==typeof r?r(e,a):r&&t(r).val(a)},!1),myXhr},data:o,dataType:"json",cache:!1,contentType:!1,processData:!1,complete:function(t){var e;try{e=JSON.parse(t.responseText)}catch(a){e=t.responseText}n&&n(e)}})}})}});